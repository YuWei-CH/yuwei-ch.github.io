---
import { localeEntries } from "../config";

const accentColor = localeEntries[0][1].accentColor;
const hasNews = localeEntries.some(([, siteConfig]) => siteConfig.news && siteConfig.news.length > 0);

const highlightHTML = (text: string) =>
  text.replace(
    /\*([^*]+)\*/g,
    `<span class="font-semibold" style="color:${accentColor}">$1</span>`
  );
---

{
  hasNews && (
    <section id="news" class="p-8 sm:p-12 md:p-16 lg:p-24 bg-gray-50">
      {localeEntries.map(([lang, siteConfig]) => {
        if (!siteConfig.news || siteConfig.news.length === 0) return;

        const newsItems =
          siteConfig.news.length < 3
            ? Array.from({ length: 3 }, (_, i) => siteConfig.news[i % siteConfig.news.length])
            : siteConfig.news;

        return (
          <div class={`lang-block lang-${lang} max-w-5xl mx-auto space-y-6`}>
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
              <div>
                <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900">
                  {siteConfig.ui.news.title}
                </h2>
                <div
                  class="w-[75px] h-[5px] mt-2 rounded-full"
                  style={`background-color: ${accentColor}`}
                />
              </div>
            </div>

            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
              <p class="text-sm text-gray-600">{siteConfig.ui.news.subtitle}</p>
              <p class="text-sm text-gray-500">{siteConfig.ui.news.hint}</p>
            </div>

            <div class="relative">
              <div class="flex gap-4 sm:gap-5 overflow-x-auto snap-x snap-mandatory pb-4 sm:pb-6 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100">
                {newsItems.map((item) => (
                  <div class="flex-none basis-1/3 snap-start">
                    <div class="p-4 sm:p-5 h-full">
                      <p
                        class="text-xs sm:text-sm font-semibold uppercase tracking-wide"
                        style={{ color: accentColor }}
                      >
                        {item.date}
                      </p>
                      <h3 class="mt-2 text-lg sm:text-xl font-semibold text-gray-900">
                        {item.title}
                      </h3>
                      <p
                        class="mt-2 text-sm sm:text-base text-gray-600 leading-relaxed"
                        set:html={highlightHTML(item.description)}
                      />
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      })}
    </section>
  )
}
